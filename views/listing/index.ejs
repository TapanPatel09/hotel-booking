<% layout("/layouts/boylerplate.ejs") %>

<!-- ========================= STYLES ========================= -->
<style>
  .card {
    transition: all 0.3s ease-in-out;
  }

  .card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
    transform: translateY(-5px);
    cursor: pointer;
  }
.gst-wrapper {
  border: 2px solid #ccc;
  border-radius: 25px;
  padding: 6px 16px;
  background-color: #fff;
  height: 40px;
  display: flex;    
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
}

.gst-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid #ccc;
  border-radius: 2rem;
  padding: 6px 14px;
  background-color: #fff;
  cursor: pointer;
  transition: all 0.3s ease;
  height: 100%;
  overflow: hidden;
}

.gst-checkbox {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 2px solid #999;
  border-radius: 50%;
  background-color: #e6e6e6;
  margin-right: 8px;
  position: relative;
  cursor: pointer;
  display: inline-block;
}

.gst-checkbox:checked {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.gst-label {
  font-weight: 500;
  font-size: 1rem;
  color: #333;
  white-space: nowrap;
}

  .tak_toggle input {
    margin-right: 10px;
  }
  
</style>

<% const activeCategory = typeof categoryName !== 'undefined' ? categoryName : null; %>

<% const categories = [
  { name: "Trending", icon: "fa-fire" },
  { name: "Room", icon: "fa-bed" },
  { name: "Iconic cities", icon: "fa-city" },
  { name: "Castles", icon: "fa-chess-rook" },
  { name: "Swimming Pools", icon: "fa-swimmer" },
  { name: "Camping", icon: "fa-campground" },
  { name: "Farms", icon: "fa-tractor" },
  { name: "Arctic", icon: "fa-snowflake" },
  { name: "Domes", icon: "fa-igloo" },
  { name: "Boats", icon: "fa-sailboat" }
]; %>

<!-- ========================= CATEGORY FILTER BAR ========================= -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<div class="container mt-5">
  <div class="d-flex justify-content-between overflow-auto pb-3 border-bottom">

    <!-- Categories -->
    <% categories.forEach(cat => { 
         const isActive = activeCategory === cat.name; %>
      <a 
        href="/listings/category/<%= cat.name %>" 
        class="text-center text-decoration-none px-3 py-2 <% if (isActive) { %> text-primary border-bottom border-2 <% } else { %> text-muted <% } %>">
        <i class="fa <%= cat.icon %> fa-lg d-block mb-1"></i>
        <small><%= cat.name %></small>
      </a>
    <% }) %>

    <!-- GST Toggle -->
   <!-- GST Toggle -->
<div class="d-flex align-items-center gst-wrapper">
  <div class="form-check form-switch m-0">
    <input class="form-check-input" type="checkbox" role="switch" id="gstToggle">
  </div>
  <label class="form-check-label ms-2" for="gstToggle">+18% GST</label>
</div>


    
</div>
  </div>
</div>

<!-- ========================= PAGE HEADING ========================= -->
<div class="container mb-4 mt-3">
  <% if (typeof categoryName !== 'undefined') { %>
    <h2>Category: <%= categoryName %></h2>
  <% } else { %>
    <h2>All Listings</h2>
  <% } %>
</div>

<!-- ========================= LISTINGS GRID ========================= -->
<div class="container">
  <div class="row">
    <% if (alllisting.length === 0) { %>
      <div class="col-12">
        <p class="text-muted">No listings found in this category.</p>
      </div>
    <% } %>

    <% alllisting.forEach(listing => { %>
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm listing-card" data-category="<%= listing.category %>">
          <img src="<%= listing.image.url %>" class="card-img-top" style="height: 250px; object-fit: cover;" alt="<%= listing.title %>">
          <div class="card-body">
            <h5 class="card-title"><%= listing.title %></h5>
            <p class="card-text"><%= listing.description.length > 100 ? listing.description.substring(0, 100) + '...' : listing.description %></p>
            <p><strong>Price:</strong> â‚¹<span class="price"><%= listing.price %></span></p>
            <p><strong>Location:</strong> <%= listing.location %>, <%= listing.country %></p>
            <a href="/listings/<%= listing._id %>" class="btn btn-sm btn-outline-success">View Details</a>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<!-- ========================= GST Script ========================= -->
<script>
  const gstToggle = document.getElementById("gstToggle");
  const priceElements = document.querySelectorAll(".price");

  gstToggle.addEventListener("change", () => {
    priceElements.forEach(el => {
      const originalPrice = parseFloat(el.innerText);
      if (gstToggle.checked) {
        const gstPrice = (originalPrice * 1.18).toFixed(2) + "+18 GST Added";
        el.innerText = gstPrice;
      } else {
        const basePrice = (originalPrice / 1.18).toFixed(2);
        el.innerText = basePrice;
      }
    });
  });
</script>
